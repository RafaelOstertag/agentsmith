.\" -*- nroff -*-
.\" $Id$
.TH @PACKAGE@.conf @FILE_SECTION@ 2011
.\"=========================================================
.\" NAME
.\"=========================================================
.SH NAME
\fB@PACKAGE@.conf\fR \- configuration file for @PACKAGE@
.\"=========================================================
.\" SYNTAX
.\"=========================================================
.SH SYNTAX
.nf
<\fIoption\fR>=<\fIvalue\fR>

# Comments
.fi
.\"=========================================================
.\" DESCRIPTION
.\"=========================================================
.SH DESCRIPTION
The syntax of the file is very strict. Options must be placed at the
very beginning of the line. It is not allowed to have leading spaces
in front of the option name. It is also not allowed to have the equal
sign surrounded by trailing or leading spaces, e.g.:
.nf

foo = bar
foo= bar
foo =bar

.fi
are all invalid configuration directives.
.P
Comments start with a \fB#\fR at the beginning of the line with no leading
space.
.P
Empty lines are ignored.
.P
Invoking \fB@PACKAGE@\fR with the \fB-t\fR option specified checks the
configuration file. It is recommended to run this command every time the
configuration file has been altered.
.\"=========================================================
.\" OPTIONS
.\"=========================================================
.SH OPTIONS
The following options are recognized:
.IP \fIpidfile\fR
The location of the pid file. That is where \fB@PACKAGE@\fR writes the process
id when run in daemon mode.

Default: @DEFAULT_PIDFILE@
.IP \fIsyslogfile\fR
The location of the file to be monitored, i.e. this file will be continuously
monitored for new lines which are matched against the regular expression (see
\fIregex\fR further down).

Default: /var/log/authlog
.IP \fIaction_threshold\fR
The number of occurrences of a host until the action script will be called (see
also \fItime_interval\fR). In this context, the term occurrence refers to the
matching of the regular expression to  a line in \fIlogfile\fR.

Default: 3
.IP \fItime_interval\fR
The action script will be called if a host has \fIaction_threshold\fR
occurrences within this time span (in seconds).

Default: 60
.IP \fIpurge_after\fR
If a host has no more occurrence in the log file for \fIpurge_after\fR
seconds, it will be purged from memory. For each host that is purged,
the action script will be called (see also @PACKAGE@(@ADM_SECTION@)).

Default: 3600
.IP \fIserver\fR
Enable the server mode of agentsmith. In server mode, agentsmith
allows other agentmsith daemons to update the local host records, and
thus make the server execute the action script. A value of 1 (`one')
enables the server. A value of 0 (`zero') disables the server.

If the server is enabled, agentsmith requires \fIssl_ca_cert\fR,
\fIssl_server_cert\fR, and \fIss_server_key\fR to be set properly.

Default: 0
.IP \fIaction\fR
The file path to the action script. It will be called if a)
\fIaction_threshold\fR is reached or exceeded in \fItime_interval\fR
seconds b) the host record is removed due to purging.

The action script is called with the following options
.nf

 <\fIip_address\fR> <\fIoccurrences\fR> \fInew\fR|\fIremove\fR <\fIorigin\fR>
.fi

The literal \fInew\fR is passed when a host meets the action threshold and time
interval criteria. The literal \fIremove\fR is passed when a host is purged
from memory.

\fIorigin\fR is either the literal \fIlocalhost\fR if the host
appeared in the local \fIsyslog\fR file, or the IP address of the
agentsmith client sending this host information.
\br

Default: /bin/true
.IP \fIexclude\fR
File that contains IP addresses to be ignored by \fB@PACKAGE@\fR. The
specified file will be re-read upon \fISIGHUP\fR. See also
agentsmith_exclude(@FILE_SECTION@).

Default: none
.IP \fIregex\fR
The regular expression used to identify the IP address of offending hosts. See
REGULAR EXPRESSION.

Default: Failed keyboard-interactive for [\\w ]+ from ([\\d]{1,3}\\.[\\d]{1,3}\\.[\\d]{1,3}\\.[\\d]{1,3})
.\"=========================================================
.\" REGULAR EXPRESSION
.\"=========================================================
.SH REGULAR EXPRESSION
\fB@PACKAGE@\fR uses Perl compatible regular expressions. The expression used by
\fB@PACKAGE@\fR may only contain one catching pattern \'(...)\' which has to
catch the IP address of the offending host. If you need to use alternations
\'(...|...)\' write them like this
.nf

(?:a|b)
.fi

Invoking \fB@PACKAGE@\fR with the \fB-t\fR option set will test the regular
expression for correctness as required by \fB@PACKAGE@\fR.
.\"=========================================================
.\" EXAMPLE
.\"=========================================================
.SH EXAMPLE
This is an example configuration with default values filled in
.nf

pidfile=@DEFAULT_PIDFILE@
syslogfile=/var/log/authlog
action_threshold=3
time_interval=60
purge_after=3600
action=/bin/true
regex=Failed keyboard-interactive for [\\w ]+ from ([\\d]{1,3}\\.[\\d]{1,3}\\.[\\d]{1,3}\\.[\\d]{1,3})
.fi

.\"=========================================================
.\" SEE ALSO
.\"=========================================================
.SH SEE ALSO
@PACKAGE@(@ADM_SECTION@), agentsmith_exclude(@FILE_SECTION@), PCRE \-
Perl Compatible Regular Expressions (http://www.pcre.org)
.\"=========================================================
.\" AUTHOR
.\"=========================================================
.SH AUTHOR
Rafael Ostertag <rafi@guengel.ch>
